@using Ztop.Todo.Model;
@using Ztop.Todo.ActiveDirectory;
@{
    ViewBag.Title = "报销系统";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<Sheet> list = ViewBag.List;
    List<Sheet> WaitForMe = ViewBag.WaitForMe;//  需要我审核的报销单
    List<Sheet> MyCheck = ViewBag.Checks;

}

<div class="col-md-12">
    <h3>@(Identity.Name)  您好! &nbsp;&nbsp;</h3>
    @if (Identity.Name == "蒋雷"||Identity.Name=="袁洋"||Identity.Name== "申屠杜平")
    {
       <a href="/Report/DownloadExcel?name=申屠杜平&&order=@(Order.Time)&&content=招待费&&sheetType=日常报销" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-download"></i>下载招待费Excel</a>
       <hr />
    }
</div>

<div class="row">
    <div class="col-md-12 col-xs-12 col-sm-12">
        @{ 
            Html.RenderPartial("_Cash", list.Where(e => e.Status == Status.Cash).ToList() as object);
        }
    </div>
</div>

<div class="row">
    <div class="col-md-12 col-xs-12 col-sm-12">
        @{ 
            Html.RenderPartial("_OutLine", list.Where(e => e.Status == Status.OutLine).ToList() as object);
        }
    </div>
    <div class="col-md-12 col-xs-12 col-sm-12">

        @{ 
            Html.RenderPartial("_Check", list.Where(e => (((int)e.Status) > 0 && ((int)e.Status) < 5) || e.Status == Status.RollBack).ToList() as object);
        }
    </div> 
</div>
<div class="row">
    <div class="col-md-12 col-xs-12 col-sm-12" >
        @{ 
            Html.RenderPartial("_Done", list.Where(e => e.Status == Status.Examined).Take(10).ToList() as object);
        }
    </div>
</div>

<div class="row">
    <hr />
    @if (WaitForMe != null)
    {
        <div class="col-md-6 col-xs-12 col-sm-12">
            <div class="panel panel-success">
                <div class="panel panel-heading">
                    <h4 class="panel-title">
                        待审核报销(注:需要我审核的报销单)
                        <a style="float:right;font-size: 0.8em;" href="list.html">
                            <em class="glyphicon glyphicon-info-sign"></em> 详情
                        </a>
                    </h4>
                </div>
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>系统流水编号</th>
                            <th>填报日期</th>
                            <th>报销金额[元]</th>
                            <th>报销人</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var sheet in WaitForMe.Where(e => e.Status != Status.Filing))
                            {
                                <tr>
                                    <td><a href="/Report/Detail?id=@(sheet.ID)">@(sheet.PrintNumber)</a></td>
                                    <td>@(sheet.Time.ToLongDateString())</td>
                                    <td>@(sheet.Money)</td>
                                    <td>@(sheet.Name)</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    @if (MyCheck != null)
    {
        <div class="col-md-6 col-xs-12 col-sm-12">
            <div class="panel panel-primary">
                <div class="panel panel-heading">
                    <h4 class="panel-title">
                        审核历史
                        <a href="/Report/Review" style="float:right;font-size: 0.8em;">
                            <em class="glyphicon glyphicon-info-sign"></em> 详情
                        </a>
                    </h4>
                </div>
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>系统流水编号</th>
                            <th>单据编号</th>
                            <th>填报日期</th>
                            <th>报销金额[元]</th>
                            <th>报销人</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sheet in MyCheck.OrderByDescending(e => e.CheckNumber))
                        {
                            <tr>
                                <td><a href="/Report/Detail?id=@(sheet.ID)">@(sheet.PrintNumber)</a></td>
                                <td>@(sheet.CheckNumber)</td>
                                <td>@(sheet.Time.ToLongDateString())</td>
                                <td>@(sheet.Money)</td>
                                <td>@(sheet.Name)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>
<div class="row">
    @if (Identity.Name == XmlHelper.GetManager())
    {
        var li = WaitForMe.Where(e => e.Status == Status.Filing).ToList();
        <div class="col-md-6 col-xs-12 col-sm-12">
            <div class="panel panel-primary">
                <div class="panel panel-heading">
                    <h4 class="panel-title">
                        等待归档报销<span class="badge">@(li.Count)</span>
                    </h4>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>系统流水编号</th>
                            <th>填报日期</th>
                            <th>报销金额</th>
                            <th>报销人</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var sheet in li)
                            {
                                <tr>
                                    <td><a href="/Report/Detail?id=@(sheet.ID)">@(sheet.PrintNumber)</a></td>
                                    <td>@(sheet.Time.ToLongDateString())</td>
                                    <td>@(sheet.Money)</td>
                                    <td>@(sheet.Name)</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

                            }
</div>







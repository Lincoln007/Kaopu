@using Ztop.Todo.Model;
@using Ztop.Todo.ActiveDirectory;
@{
    ViewBag.Title = "报销系统";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<Sheet> OutList = ViewBag.OutList;//报销单  草稿
    List<Sheet> ExaminingList = ViewBag.ExaminingList;//报销单 正在报销
    List<Sheet> ExaminList = ViewBag.ExaminList;//报销完成
    List<Sheet> WaitForMe = ViewBag.WaitForMe;//  需要我审核的报销单
    List<Sheet> MyCheck = ViewBag.Checks;
    int Serial = 1;

}

<div class="col-md-12">
    <h3>@(Identity.Name)  您好! &nbsp;&nbsp;</h3>
    @if (Identity.Name == "蒋雷")
    {
       <a href="/Report/DownloadExcel?name=申屠杜平&&order=@(Order.Time)&&content=招待费&&sheetType=日常报销" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-download"></i>下载招待费Excel</a>
       <hr />
    }
</div>

<div class="row">
    <div class="col-md-12 col-xs-12 col-sm-12">
        <div class="panel panel-default">
            <div class="panel panel-heading">
                <h4 class="panel-title">
                    最近草稿
                    <a style="float:right;font-size:0.8em" href="/Report/List?Position=草稿">
                        <em class="glyphicon glyphicon-info-sign"></em>详情
                    </a>
                </h4>
            </div>
            <div class="panel panel-body">
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>系统流水编号</th>
                            <th>填报日期</th>
                            <th>报销金额[元]</th>
                            <th>备注</th>
                            <th>报销类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var item in OutList)
                            {
                                <tr>
                                    <td><a href="/Report/Detail?id=@(item.ID)">@(item.PrintNumber)</a> </td>
                                    <td>@(item.Time.ToLongDateString())</td>
                                    <td>@(item.Money)</td>
                                    <td>@(item.Remarks)</td>
                                    <td>@(item.Type.GetDescription())</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <div class="col-md-12 col-xs-12 col-sm-12">
        <div class="panel panel-warning">
            <div class="panel panel-heading">
                <h4 class="panel-title">
                    审核中的报销
                    <a style="float:right;font-size:0.8em;" href="/Report/List?Position=未审核">
                        <em class="glyphicon glyphicon-info-sign"></em>详情
                    </a>
                </h4>
            </div>
            <div class="panel panel-body">
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>系统流水编号</th>
                            <th>填报日期</th>
                            <th>报销金额[元]</th>
                            <th>备注</th>
                            <th>报销类型</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var item in ExaminingList)
                            {
                                <tr>
                                    <td><a href="/Report/Detail?id=@(item.ID)" class="@(item.Status==Status.RollBack?"text-danger":"")">@(item.PrintNumber)</a> </td>
                                    <td>@(item.Time.ToLongDateString())</td>
                                    <td>@(item.Money)</td>
                                    <td>@(item.Remarks)</td>
                                    <td>@(item.Type.GetDescription())</td>
                                    <td>@(item.Status.GetDescription())</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div> 
</div>
<div class="row">
    <div class="col-md-12 col-xs-12 col-sm-12" >
        <div class="panel panel-info">
            <div class="panel panel-heading">
                <h4 class="panel-title">
                    最近已完成的报销
                    <a style="float:right;font-size: 0.8em;" href="/Report/List?Position=已审核">
                        <em class="glyphicon glyphicon-info-sign"></em> 详情
                    </a>
                </h4>
            </div>
            <div class="panel panel-body">
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>系统流水编号</th>
                            <th>填报日期</th>
                            <th>报销金额[元]</th>
                            <th>备注</th>
                            <th>报销类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var item in ExaminList)
                            {
                                <tr>
                                    <td><a href="/Report/Detail?id=@(item.ID)">@(item.PrintNumber)</a> </td>
                                    <td>@(item.Time.ToLongDateString())</td>
                                    <td>@(item.Money)</td>
                                    <td>@(item.Remarks)</td>
                                    <td>@(item.Type.GetDescription())</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <hr />
    @if (WaitForMe != null)
    {
        <div class="col-md-6 col-xs-12 col-sm-12">
            <div class="panel panel-success">
                <div class="panel panel-heading">
                    <h4 class="panel-title">
                        待审核报销(注:需要我审核的报销单)
                        <a style="float:right;font-size: 0.8em;" href="list.html">
                            <em class="glyphicon glyphicon-info-sign"></em> 详情
                        </a>
                    </h4>
                </div>
                <div class="panel panel-body">
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>系统流水编号</th>
                                <th>填报日期</th>
                                <th>报销金额[元]</th>
                                <th>报销人</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                foreach (var sheet in WaitForMe.Where(e => e.Status != Status.Filing))
                                {
                                    <tr>
                                        <td><a href="/Report/Detail?id=@(sheet.ID)">@(sheet.PrintNumber)</a></td>
                                        <td>@(sheet.Time.ToLongDateString())</td>
                                        <td>@(sheet.Money)</td>
                                        <td>@(sheet.Name)</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    @if (MyCheck != null)
    {
        <div class="col-md-6 col-xs-12 col-sm-12">
            <div class="panel panel-primary">
                <div class="panel panel-heading">
                    <h4 class="panel-title">
                        审核历史
                        <a href="/Report/Review" style="float:right;font-size: 0.8em;">
                            <em class="glyphicon glyphicon-info-sign"></em> 详情
                        </a>
                    </h4>
                </div>
                <div class="panel panel-body">
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>系统流水编号</th>
                                <th>单据编号</th>
                                <th>填报日期</th>
                                <th>报销金额[元]</th>
                                <th>报销人</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach(var sheet in MyCheck.OrderByDescending(e=>e.CheckNumber))
                            {
                                <tr>
                                    <td><a href="/Report/Detail?id=@(sheet.ID)">@(sheet.PrintNumber)</a></td>
                                    <td>@(sheet.CheckNumber)</td>
                                    <td>@(sheet.Time.ToLongDateString())</td>
                                    <td>@(sheet.Money)</td>
                                    <td>@(sheet.Name)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>
<div class="row">
    @if (Identity.Name == XmlHelper.GetManager())
    {
        <div class="col-md-6 col-xs-12 col-sm-12">
            <div class="panel panel-primary">
                <div class="panel panel-heading">
                    <h4 class="panel-title">
                        等待归档报销
                    </h4>
                </div>
                <div class="panel panel-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>系统流水编号</th>
                                <th>填报日期</th>
                                <th>报销金额</th>
                                <th>报销人</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                foreach (var sheet in WaitForMe.Where(e => e.Status == Status.Filing))
                                {
                                    <tr>
                                        <td><a href="/Report/Detail?id=@(sheet.ID)">@(sheet.PrintNumber)</a></td>
                                        <td>@(sheet.Time.ToLongDateString())</td>
                                        <td>@(sheet.Money)</td>
                                        <td>@(sheet.Name)</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
                                }
</div>






